name: CI
on:
  pull_request:
  merge_group:
    types: [checks_requested]

permissions: {}

jobs:
  build:
    uses: ./.github/workflows/build.yml
  tests:
    uses: ./.github/workflows/tests.yml

  check-all-green:
    if: always()
    needs:
    - build
    - tests
    runs-on: ubuntu-22.04
    steps:
    - name: Collect statuses from all jobs
      uses: re-actors/alls-green@05ac9388f0aebcb5727afa17fcccfecd6f8ec5fe # v1.2.2
      with:
        jobs: ${{ toJSON(needs) }}
